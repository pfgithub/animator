import{c as e,u as t,i as n,s as o,t as r,a as i,o as a,b as s,d as l,e as c,f as d,k as u,g as f,h as m,E as g,j as p,F as h,l as v,r as w,m as y}from"./vendor.dd9b68ac.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const n of e)if("childList"===n.type)for(const e of n.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();function b(e,t){var n,o;const r=null!=(o=null!=(n=t[e.kind])?n:t.unsupported)?o:()=>{throw new Error("condition "+e.kind+" was not handled and no unsupported branch")};return()=>r(e)}function x(e,t){return b(e,t)()}function k(t){return e((()=>b(t.item,t.children)()))}function _(t){const n=e((()=>t.when),void 0,{equals:(e,t)=>!e==!t});return e((()=>n()?t.children:t.fallback))}function N(n){return e((()=>{var e,o;if((null==(o=null==(e=n.if)?void 0:e[0])||o)&&null!=n.when){const e=n.children;return t((()=>e(n.when)))}return n.fallback}))}function T(e,t){const n=document.getSelection();if(!1===(null==n?void 0:n.isCollapsed))return!1;let o=e;for(;o&&o!==t;){if(o instanceof HTMLElement&&("A"===o.nodeName||"BUTTON"===o.nodeName||"VIDEO"===o.nodeName||"AUDIO"===o.nodeName||"INPUT"===o.nodeName||"TEXTAREA"===o.nodeName||"IFRAME"===o.nodeName||o.classList.contains("resizable-iframe")||o.classList.contains("handles-clicks")))return!1;o=o.parentNode}return!0}let $=function(e,t){for(const n of Object.keys(t.frames).reverse()){const t=+n;if(e>=t)return t}throw new Error("requested frame "+e+" not found. note: the zero frame is required to exist.")},S=function(e,t,o){const r=new Set;let i=t;for(const a of e)i=x(a,{add_polygon:e=>{var t;const o=null!=(t=i.frames[e.frame])?t:{merged_polygons:[],thumbnail:[]};r.add(e.frame);const a=n.union(o.merged_polygons,[e.polygon]),s={...o,merged_polygons:a};return{...i,frames:{...i.frames,[e.frame]:s}}},erase_polygon:e=>{var t;const o=null!=(t=i.frames[e.frame])?t:{merged_polygons:[],thumbnail:[]};r.add(e.frame);const a=n.difference(o.merged_polygons,[e.polygon]),s={...o,merged_polygons:a};return{...i,frames:{...i.frames,[e.frame]:s}}}});for(const n of r){const e=i.frames[n];if(!e)continue;const t={...e,thumbnail:E(e.merged_polygons,o)};i={...i,frames:{...i.frames,[n]:t}}}return i};function E(e,t){return o({type:"Feature",geometry:{type:"MultiPolygon",coordinates:e}},Math.min(...t.drawing_size)/50).geometry.coordinates}const L=r('<div class="h-full"></div>'),D=r('<canvas class="w-full h-full fixed top-0 left-0 bottom-0 right-0"></canvas>');function A(e){return document.documentElement.classList.add("no-interact"),a((()=>document.documentElement.classList.remove("no-interact"))),(()=>{const t=L.cloneNode(!0);return s(t,l(C,{get state(){return e.state},get applyAction(){return e.applyAction}}),null),s(t,l(P,{get state(){return e.state},get applyAction(){return e.applyAction}}),null),t})()}function C(e){return l(W,{render:(t,n)=>{const o=Date.now();t.fillStyle="#ffffff",t.fillRect(0,0,n.width,n.height);const r=z();let i=e.state.frame;null!=r&&(i=r*e.state.config.framerate|0);const a=$(i,e.state.cached_state),s=e.state.cached_state.frames[a],l=a===i||null!=r;t.fillStyle=l?"#000000":"#555555",O(t,s.merged_polygons);const c=Date.now();t.fillStyle="#000000",t.fillText("Last Update ms: "+e.state.update_time,10,20),t.fillText("Draw ms: "+(c-o),10,30),t.fillText("Vertices: "+s.merged_polygons.reduce(((e,t)=>e+t.reduce(((e,t)=>e+t.length),0)),0),10,40),t.fillText("Frame: "+i+" / "+e.state.max_frame,10,50),t.fillText("Audio: "+e.state.config.attribution.author.text+" - "+e.state.config.attribution.title.text,10,60)}})}let M=null;const[z,j]=i(null);function I(e){e.source.addEventListener("ended",(()=>{}));const t=()=>M?(j(M.offset+M.context.currentTime),!0):(j(null),!1);t(),function(e){const t=()=>requestAnimationFrame((()=>{e()&&t()}));t()}(t)}function R(){M&&(M.source.stop(),M=null)}function P(t){const[n,o]=i(new Map),r=e=>u(e,{simulatePressure:e.every((e=>.5===e[2]))}),s=e=>[e.pageX,e.pageY,e.pressure],c=new Map,f=e=>{const t=c.get(e);if(!t||0===t.points.size){const t={points:new Map,mode:{kind:"draw"}};return c.set(e,t),t}return t},m=()=>{let e=t.state.frame/t.state.config.framerate;e<0&&(e=0),e>t.state.audio.duration&&(e=t.state.audio.duration);const n=t.state.audio_ctx.createBufferSource();n.buffer=t.state.audio,n.connect(t.state.audio_ctx.destination),n.playbackRate.setValueAtTime(1,0),n.start(0,e,t.state.audio.duration-e),function(e){R(),M={...e,offset:e.offset-e.context.currentTime},I(e)}({source:n,offset:e,context:t.state.audio_ctx})},g=e=>{e.preventDefault();const n=f(e.pointerType);if(n.points.set(e.pointerId,{start:Date.now(),point:s(e)}),"touch"===e.pointerType&&n.points.size>1){if("zoom"===n.mode.kind||[...n.points.values()][0].start<Date.now()-200)return void n.points.delete(e.pointerId);n.mode={kind:"zoom"},o((t=>{const n=new Map(t);return n.delete(e.pointerType),n})),t.applyAction({kind:"undo"});const r=[...n.points.values()];if(r.length<2)return;return r[0].point[0],r[0].point[1],r[1].point[0],void r[1].point[1]}if(e.pageY>window.innerHeight-200)return n.mode={kind:"switch_frame",start_x:e.pageX},void m();o((t=>new Map(t).set(e.pointerType,[s(e)])))};document.addEventListener("pointerdown",g),a((()=>document.removeEventListener("pointerdown",g)));const[p,h]=i(0),v=e=>{const n=f(e.pointerType),r=n.points.get(e.pointerId);if(r){if(e.preventDefault(),r.point=s(e),"touch"===e.pointerType&&"zoom"===n.mode.kind){const e=[...n.points.values()];if(e.length<2)return;return e[0].point[0],e[0].point[1],e[1].point[0],void e[1].point[1]}if("switch_frame"===n.mode.kind){const o=t.state.frame;for(;e.pageX<n.mode.start_x-20;)t.applyAction({kind:"set_frame",frame:t.state.frame+1}),n.mode.start_x-=20;for(;e.pageX>n.mode.start_x+20;)t.applyAction({kind:"set_frame",frame:t.state.frame-1}),n.mode.start_x+=20;const r=(e.pageX-n.mode.start_x+20)/40,i=.3,a=50;return h(r**i/(r**i+(1-r)**i)*(2*a)-a),void(t.state.frame!==o&&m())}o((t=>{var n;return new Map(t).set(e.pointerType,[...null!=(n=t.get(e.pointerType))?n:[],s(e)])}))}};document.addEventListener("pointermove",v),a((()=>document.removeEventListener("pointermove",v)));const w=e=>{var i;e.preventDefault();const a=f(e.pointerType);if(!a.points.has(e.pointerId))return;if(a.points.delete(e.pointerId),"touch"===e.pointerType&&"zoom"===a.mode.kind)return void a.points.size;if("switch_frame"===a.mode.kind)return R(),void h(0);const s=null!=(i=n().get(e.pointerType))?i:[];d((()=>{o((t=>{const n=new Map(t);return n.delete(e.pointerType),n}));const n=r(s);n.some((e=>isNaN(e[0])||isNaN(e[1])))||t.applyAction({kind:"touch"===e.pointerType||2===e.button?"erase_polygon":"add_polygon",polygon:n,frame:t.state.frame})}))};document.addEventListener("pointerup",w),a((()=>document.removeEventListener("pointerup",w)));const y=e=>{const t=f(e.pointerType);t.points.has(e.pointerId)&&(t.points.delete(e.pointerId),"touch"===e.pointerType&&"zoom"===t.mode.kind||("switch_frame"!==t.mode.kind?o((t=>{const n=new Map(t);return n.delete(e.pointerType),n})):h(0)))};document.addEventListener("pointercancel",y),a((()=>document.removeEventListener("pointercancel",y)));const b=e=>{e.preventDefault()};document.addEventListener("contextmenu",b),a((()=>document.removeEventListener("pointercancel",b)));const x=e((()=>[...n().values()].map(r)));return l(W,{render:(e,n)=>{var o;const r=Date.now();e.fillStyle="#000";for(const t of x()){e.beginPath();let n=!0;for(const[o,r]of t)n?(e.moveTo(o,r),n=!1):e.lineTo(o,r);e.fill()}e.fillStyle="#aaa",e.fillRect(0,n.height-200,n.width,200);for(let l=-5;l<5;l++){const o=l+t.state.frame;if(o<0)continue;const r=$(o,t.state.cached_state),i=r===o,a=t.state.cached_state.frames[r].thumbnail;if(e.save(),e.translate(n.width/2-90+250*l,n.height-200+45),e.scale(.1,.1),0===l){e.fillStyle="#999";const n=100,o=440;e.fillRect(-n,-o,t.state.config.drawing_size[0]+2*n,t.state.config.drawing_size[1]+2*o)}e.translate(p()/.1,0),e.fillStyle="#fff",e.fillRect(0,0,...t.state.config.drawing_size),e.fillStyle=i?"#000":"#888",O(e,a),e.restore()}e.fillStyle="#000";const i=t.state.audio_data,a=t.state.frame/t.state.config.framerate*t.state.audio.sampleRate|0;for(let t=0;t<15;t++)e.fillText(""+Math.abs(null!=(o=i[a+t])?o:0),10,n.height-200+10*(t+5));const s=Date.now();e.fillText("Draw ms: "+(s-r),10,n.height-200+20),e.fillText("Frame: "+t.state.frame+" / "+t.state.max_frame,10,n.height-200+30)}})}function O(e,t){for(const n of t)F(e,n)}function F(e,t){e.beginPath();for(const n of t){let t=!0;for(const[o,r]of n)t?(e.moveTo(o,r),t=!1):e.lineTo(o,r)}e.fill()}function W(e){const t=()=>({width:window.innerWidth,height:window.innerHeight}),[n,o]=i(t()),r=()=>{o(t())};return window.addEventListener("resize",r),a((()=>window.removeEventListener("resize",r))),(()=>{const t=D.cloneNode(!0);return(t=>{const o=t.getContext("2d");c((()=>{const r=n(),i=window.devicePixelRatio;t.width!==r.width*i&&(t.width=r.width*i),t.height!==r.height*i&&(t.height=r.height*i),o.setTransform((new DOMMatrixReadOnly).scale(i)),null==o||o.clearRect(0,0,r.width,r.height),e.render(o,r)}))})(t),t})()}const B=r('<div class="min-h-full p-4 bg-red-900 text-white"><button class="border px-2">Code</button> / <button class="border px-2">Retry</button><pre class="whitespace-pre-wrap"><code> </code></pre></div>');function U(e){const[t,n]=i(!0);return l(g,{fallback:(t,o)=>(console.log(t),(()=>{const r=B.cloneNode(!0),i=r.firstChild,a=i.nextSibling.nextSibling,s=a.nextSibling.firstChild.firstChild;return i.$$click=()=>console.log(t,e.data),a.$$click=()=>{n(!1),setTimeout((()=>n(!0)),200),o()},m((()=>s.data=t instanceof Error?t.toString()+"\n\n"+t.stack:"Something went wrong")),r})()),get children(){return l(_,{get when(){return t()},get fallback(){return"Retrying..."},get children(){return e.children}})}})}f(["click"]);const X=r('<div class="w-full max-w-md py-50"><div class="p-4 shadow-md bg-white border"></div></div>'),q=r('<div role="heading" class="text-3xl font-black">Connect to Server</div>'),H=r('<hr class="pb-4">'),J=r('<div><label><div class="text-xs font-light">Server URL:</div><input type="text" placeholder="ws://…"></label></div>'),V=r('<div class="pb-4"></div>'),Y=r('<div class="flex flex-row flex-wrap gap-4 <sm:flex-col"><button></button><button></button></div>'),G=r('<div class="pb-2"></div>'),K=r('<p class="text-sm text-gray-700"></p>'),Q=r('<span class="text-red-600">Error! </span>'),Z=r('<button class="text-blue-600 hover:underline px-1">&lt; Back</button>'),ee=r('<div role="heading" class="text-2xl font-black">Demo Projects</div>'),te=r('<p class="text-sm text-gray-700">Your work will not be saved.</p>'),ne=r('<ul class="flex flex-col gap-2"></ul>'),oe=r('<li tabindex="0"> - <!> / </li>'),re=r('<a class="underline underline-dotted hover:underline-solid" target="_blank" rel="noopener noreferrer"></a>'),ie=r('<button class="w-full h-full flex flex-col flex-wrap items-center justify-center bg-gray-100"><span class="border px-4 py-2 shadow-md bg-white transform hover:scale-110 hover:shadow-lg transition">Start</span></button>'),ae=r("<div></div>"),se=r('<svg class="animate-spin mr-1 h-5 w-5 text-black inline-block align-middle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><title>Loading…</title><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor"></path></svg>');function le(e){const[t,n]=i([]),[o,r]=p({frames:{0:{merged_polygons:[],thumbnail:[]}}}),[s,c]=i(0),[u,f]=i(0),m=e.ctx;let g,h,v,y;function b(e,t,o){g=t,h=e,v=Math.ceil(e.duration*t.framerate),y=new Float32Array(e.getChannelData(0)),n(o);const i=S(o,{frames:{0:{merged_polygons:[],thumbnail:[]}}},t);r(w(i,{merge:!0}))}const k={get actions(){return t()},cached_state:o,get update_time(){return s()},get frame(){return u()},get max_frame(){return v},get config(){return g},get audio(){return h},audio_ctx:m,get audio_data(){return y}},N=e=>{d((()=>{const t=Date.now();if("undo"===e.kind){const e=k.actions[k.actions.length-1],t=[...k.actions.slice(0,k.actions.length-1)];n(t),e&&x(e,{add_polygon:e=>f(e.frame),erase_polygon:e=>f(e.frame)});const o=S(t,{frames:{0:{merged_polygons:[],thumbnail:[]}}},k.config);r(w(o,{merge:!0}))}else if("set_frame"===e.kind)f(Math.min(k.max_frame,Math.max(0,e.frame)));else{n((t=>[...t,e]));const t=S([e],k.cached_state,k.config);r(w(t,{merge:!0}))}c(Date.now()-t)}))};window.applyAction=N;const[T,$]=i({kind:"none"});let E=null;a((()=>{E&&(E.close(),E=null)}));return l(_,{get when(){return"ready"===T().kind},get fallback(){return l(ce,{connect:e=>{const t="error"===T().kind;$({kind:"loading"}),(async()=>{t&&await new Promise((e=>setTimeout(e,300))),(e=>{E&&(E.close(),E=null),E=new WebSocket(e),E.addEventListener("close",(e=>{console.log(e),"error"!==T().kind&&$({kind:"error",message:"Websocket Closed"})})),E.addEventListener("error",(e=>{console.log(e),"error"!==T().kind&&$({kind:"error",message:"Websocket Connection Failed"})}));const t=[];E.addEventListener("message",(e=>{if(console.log("Got websocket message",e.data),"string"==typeof e.data)try{const t=JSON.parse(e.data);"error"===t.kind&&($({kind:"error",message:"Websocket Error: "+t.message}),E&&(E.close(),E=null))}catch(o){console.log(o)}const n=t.shift();n&&n(e.data)})),E.addEventListener("open",(()=>{console.log("WS opened"),(async()=>{const e=async()=>await new Promise((e=>{t.push(e)})),n=await e(),o=await e(),r=await e(),i=await e(),a=JSON.parse(n),s=JSON.parse(r),l=JSON.parse(i),c=await m.decodeAudioData(await o.arrayBuffer());if("ready"!==l.kind)throw console.log(a,s,l),new Error("error initializing");b(c,a,s.actions),$({kind:"ready"})})().then((e=>{})).catch((e=>{console.log(e),$({kind:"error",message:"Websocket Connect Error: "+e.toString()})}))})),window.ws=E})(e)})().catch((e=>{console.log(e),$({kind:"error",message:"Websocket Connection Errored. Message: "+e.toString()})}))},loadDemo:(e,t,n)=>{b(e,t,n),$({kind:"ready"})},get state(){return T()},get audio_ctx(){return e.ctx}})},get children(){return l(U,{data:k,get children(){return l(ue,{state:k,get children(){return l(A,{state:k,applyAction:N})}})}})}})}function ce(e){var t;const[n,o]=i(null!=(t=localStorage.getItem("recent-server"))?t:""),r=()=>n().startsWith("ws://"),a=()=>"loading"===e.state.kind||"loading"===u().kind,[u,f]=i({kind:"none"}),[g,p]=i(null);c((()=>{"error"===e.state.kind&&p(e.state.message)}));function v(){return!!r()&&(localStorage.setItem("recent-server",n()),e.connect(n()),!0)}return l(fe,{horizontal:!0,get children(){const t=X.cloneNode(!0),i=t.firstChild;return s(i,l(N,{get when(){return e=u(),t="ready",e.kind===t?e:null;var e,t},get fallback(){return[q.cloneNode(!0),H.cloneNode(!0),(()=>{const e=J.cloneNode(!0),t=e.firstChild.firstChild.nextSibling;return t.$$keydown=e=>{"Enter"===e.code&&v()&&e.preventDefault()},t.$$input=e=>{o(e.currentTarget.value)},m((e=>{const o="border px-3 py-2 block w-full "+(a()?"text-gray-700 bg-gray-100 cursor-not-allowed":""),r=a(),i=n();return o!==e._v$&&(t.className=e._v$=o),r!==e._v$2&&(t.disabled=e._v$2=r),i!==e._v$3&&(t.value=e._v$3=i),e}),{_v$:void 0,_v$2:void 0,_v$3:void 0}),e})(),V.cloneNode(!0),(()=>{const t=Y.cloneNode(!0),n=t.firstChild,o=n.nextSibling;return n.$$click=()=>{f({kind:"loading"}),(async()=>{const e=await fetch("/sample-projects/list.json").then((e=>e.json())),t=await Promise.all(e.map((async e=>({config:await fetch("/sample-projects/"+e+"/config.json").then((e=>e.json())),name:e}))));f({kind:"ready",demos:t})})().catch((e=>{d((()=>{f({kind:"none"}),p("Failed to load demo mode. Message: "+e.toString())}))}))},s(n,l(k,{get item(){return u()},children:{none:()=>"Use in Demo Mode",loading:()=>l(me,{}),ready:()=>"You should never see this"}})),o.$$click=()=>{v()},s(o,l(k,{get item(){return e.state},children:{none:()=>"Connect",loading:()=>l(me,{}),error:()=>"Retry"}})),m((e=>{const t="border px-4 py-2 flex-1 transition "+(a()?"text-gray-700 bg-gray-100 cursor-not-allowed":"bg-gray-200 hover:shadow-md hover:bg-white"),i=a(),s="border px-4 py-2 sm:min-w-max sm:w-30 "+(r()&&!a()?"border-green-400 bg-gradient-to-r from-green-400 to-green-500 text-white font-bold hover:shadow-md":"text-gray-700 bg-gray-100 cursor-not-allowed"),l=!r()||a();return t!==e._v$4&&(n.className=e._v$4=t),i!==e._v$5&&(n.disabled=e._v$5=i),s!==e._v$6&&(o.className=e._v$6=s),l!==e._v$7&&(o.disabled=e._v$7=l),e}),{_v$4:void 0,_v$5:void 0,_v$6:void 0,_v$7:void 0}),t})(),G.cloneNode(!0),(()=>{const e=K.cloneNode(!0);return s(e,l(N,{get when(){return g()},get fallback(){return"Note: In demo mode, your work will not be saved."},children:e=>(()=>{const t=Q.cloneNode(!0);return t.firstChild,s(t,e,null),t})()})),e})()]},children:t=>[(()=>{const e=Z.cloneNode(!0);return e.$$click=()=>{f({kind:"none"})},e})(),ee.cloneNode(!0),H.cloneNode(!0),te.cloneNode(!0),G.cloneNode(!0),(()=>{const n=ne.cloneNode(!0);return s(n,l(h,{get each(){return t.demos},children:t=>(()=>{const n=oe.cloneNode(!0),o=n.firstChild,r=o.nextSibling;return r.nextSibling,n.$$keydown=e=>{"Enter"!==e.key||T(e.target,e.currentTarget)},n.$$click=n=>{var o;T(n.target,n.currentTarget)&&(o=t,f({kind:"loading"}),(async()=>{const[t,n]=await Promise.all([fetch("/sample-projects/"+o.name+"/actions.json").then((e=>e.json())),fetch("/sample-projects/"+o.name+"/audio.mp3").then((e=>e.arrayBuffer()))]),r=await e.audio_ctx.decodeAudioData(n);e.loadDemo(r,o.config,t.actions)})().catch((e=>{d((()=>{f({kind:"none"}),p("Failed to load demo project. Message: "+e.toString())}))})))},n.className="bg-gray-100 border p-4 focus:bg-white focus:shadow-md cursor-pointer hover:bg-white hover:shadow-md outline-default transition handles-clicks",s(n,l(de,{get attribution(){return t.config.attribution.author}}),o),s(n,l(de,{get attribution(){return t.config.attribution.title}}),r),s(n,l(de,{get attribution(){return t.config.attribution.license}}),null),n})()})),n})()]})),t}})}function de(e){return(()=>{const t=re.cloneNode(!0);return s(t,(()=>e.attribution.text)),m((()=>v(t,"href",e.attribution.url))),t})()}function ue(e){const[t,n]=i(!1);return l(_,{get when(){return t()},get fallback(){return(()=>{const t=ie.cloneNode(!0);return t.$$click=()=>{const t=e.state.audio_ctx.createBufferSource();t.buffer=e.state.audio,t.connect(e.state.audio_ctx.destination),t.start(0,0,1),n(!0),t.addEventListener("ended",(()=>{n(!0)}))},t})()},get children(){return e.children}})}function fe(e){return(()=>{const t=ae.cloneNode(!0);return s(t,(()=>e.children)),m((()=>t.className="min-h-full flex flex-col flex-wrap items-center bg-gray-100"+(!0===e.horizontal?"":" justify-center"))),t})()}function me(){return(()=>{const e=se.cloneNode(!0),t=e.firstChild.nextSibling.nextSibling;return v(t,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),e})()}function ge(){const e=new AudioContext;return l(le,{ctx:e})}console.log("hmr reload"),f(["input","keydown","click"]),y((()=>l(U,{data:0,get children(){return l(ge,{})}})),document.getElementById("app"));
